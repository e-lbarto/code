<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Art-Detektionen</title>
  <style>
    body { font-family: system-ui, sans-serif; margin:0; background:#77C487; color:#333; font-size:1.25em; }
    header {
      position: relative;
      padding:16px;
      text-align:center;
      font-weight:bold;
      font-size:1.4em;
      background:#fff;
      border-bottom:1px solid #333;
      color:#333;
    }
    header .logo {
      position:absolute;
      left:16px;
      top:50%;
      transform:translateY(-50%);
      height:40px;
    }
    header .header-link { color:#333; text-decoration:none; position:relative; }
    header .header-link::after {
      content: "Station 13222 bei Birdweather.com";
      position:absolute;
      left:50%;
      top:120%;
      transform:translateX(-50%);
      background:rgba(0,0,0,0.75);
      color:#fff;
      padding:6px 10px;
      border-radius:6px;
      font-size:0.7em;
      white-space:nowrap;
      opacity:0;
      pointer-events:none;
      transition:opacity 0.3s ease;
      z-index:1000;
    }
    header .header-link:hover::after { opacity:1; }

    .box { background:#77C487; margin:12px; padding:12px; border-radius:12px; border:3px solid #333; }
    .box h2 { font-size:1.1em; margin:0 0 8px; color:#333; }
    ul { list-style:none; padding:0; margin:0; }
    li { margin:6px 0; padding:6px; background:#fff; border-radius:6px; border:1px solid #333; }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo" class="logo">
    <a href="https://app.birdweather.com/stations/13222" class="header-link" target="_blank">
      BirdNET-pi Zirndorf
    </a>
  </header>

  <div class="box">
    <h2 id="title">Alle Erkennungen</h2>
    <ul id="times"></ul>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const sciName = params.get("sci");
    document.getElementById("title").textContent = "Alle Erkennungen: " + sciName;

    const STATION_ID = 13222;
    const API_KEY = "KcjgSB72LsSbc75LvEgbZLz7";
    const BASE_URL = "https://app.birdweather.com/api/v1";

    async function loadDetections() {
      const url = `${BASE_URL}/stations/${STATION_ID}/detections?limit=500&api_key=${API_KEY}`;
      const res = await fetch(url, { headers: { "Accept":"application/json" } });
      const data = await res.json();

      const list = document.getElementById("times");
      list.innerHTML = "";

      if (Array.isArray(data?.detections)) {
        const matches = data.detections.filter(d => d.species?.scientificName === sciName);
        for (const det of matches) {
          const li = document.createElement("li");
          const dt = new Date(det.timestamp);
          li.textContent = dt.toLocaleString();
          list.appendChild(li);
        }
      }
    }

    loadDetections();
  </script>
</body>
</html>
